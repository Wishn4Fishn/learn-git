<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Learn Ansible</title>
<style>
	font.code {
		font-family: Courier New, Courier, monospace;
		background-color:lightgrey;
		color:black;
	}
	td.codecel {
		font-family: Courier New, Courier, monospace;
		background-color:lightgrey;
		color:black;
		vertical-align:top;
		text-align:left;
	}
	td.outputcel {
		font-family: Courier New, Courier, monospace;
		background-color:black;
		vertical-align:top;
		text-align:left;
	}
	td.textcel {
		font-family: "Times New Roman", Times, serif;
		background-color:powderblue;
		color:blue;
		vertical-align:top;
		text-align:left;
	}
	td.yamlcel {
		font-family: Courier New, Courier, monospace;
		background-color:white;
		vertical-align:top;
		text-align:left;
	}
	li.topic {
		color:blue;
	}
	ul.disc {
		list-style-type:disc;
	}
	<!-- space: &nbsp; &emsp; -->
</style>
</head>
<body style="background-color:powderblue">
<h1 style="color:blue;font-size:60px;font-family:courier;" title="LinkedIn course by Jesse Keating">
	<center>Learn Ansible</center>
</h1>
<p>
<a href="https://docs.ansible.com/ansible/latest/index.html">Ansible Documentation</a>
<p>
<ul class="disc">
	<li class="topic">Course Description</li>
	Automation tools can help transform unwieldly IT tasks—managing zero downtime rolling updates, for example—into something far more manageable. In this course, explore Ansible, an easy-to-use IT automation engine. To begin, instructor Jesse Keating explains what the Ansible system is, and how to install Ansible on a Linux operating system so you can start experimenting with it. Next, Jesse goes into the different components in an Ansible system, covering concepts such as how to work with hosts and variables and control task and play behavior. After he goes over the fundamental concepts of this system, Jesse shares some of the high-level use cases that Ansible was designed to tackle.
	<p>
	<li class="topic">Prerequisetes</li>
		<dt><table style="width:250px;border:1px solid black">
			<caption>Built out Linux server in AWS QA.</caption>
			<tr><th style="border:1px solid black">Server Name</th><th style="border:1px solid black">Ip Address</th></tr>
			<tr><td style="border:1px solid black;align:center">vpc48-ym7j-2q17</td><td style="border:1px solid black">10.253.148.232</td></tr>
			</table>
		</dt>
		<dt>Shutdown when completed working each day.</dt>
		<dt>Re-start using the AWS QA UI</dt>
		<dd>- Is it possible to re-start from a cmd line without having to use the AWS UI?</dd>
	<p>
	<li class="topic">Learning objectives</li>
		<ul class="disc"> 
			<li>What is Ansible?</li>
			<li>Working with hosts and variables</li>
			<li>Controlling task and play behavior</li>
			<li>Coordinating complicated sets of actions</li>
			<li>Managing system configurations</dt>
			<li>Reacting to configuration changes</li>
			<li>Repeating a task across a fleet</li>
			<li>Managing extensions in Ansible</li>
		</ul>
</ul>

<ol type="1">
	<li class="topic">What is Ansible</li>
	<ul class="disc">
		<li class="topic">An introductioon to Ansible</li>
			<dt>Ansible is a task execution engine</dt>
			<dt>Can target local computer</dt>
			<dt>Can also target remote computers</dt>
			<dd>- Ansibles most important feature</dd>
			<dt>Ansibleat Scale</dt>
			<dd>- Execute tasks on multiple systems at the same time</dd>
			<dt>Can also target remote computers</dt>
			<dd>- Ansibles most important feature</dd>
			<dt>Modes of Operation</dt>
			<dd>- Linear (default), as the set of machines complete a task they are given the next task.</dd>
			<dd>- Serial, one server/batch of servers are completed before moving on to the next server/batch.</dd>
			<dd>&emsp;Rolling Deployments</dd>
			<dd>&emsp;&emsp;-Smaller batches in specific order</dd>
			<dd>&emsp;&emsp;-Ease a change into production</dd>
			<dd>&emsp;&emsp;-Minimize impact of a specific service</dd>
			<dd>- Free, machines complete as fast as they can without waiting for the others to complate.</dd>
			<dd>&emsp;Not possible for one host to rely on data or state of another host.</dd>
			<dt>Ansible used YAML files to process instructions.</dt>
		<li class="topic">Low-cost fleet management</li>
			<dt>Lightweight</dt>
			<dd>- only a single control system where the ansible system in installed.</dd>
			<dd>- this system will control the fleet.</dd>
			<dt>Minimal requirements</dt>
			<dd>- Python and a few libraries</dd>
			<dt>No Agents required</dt>
			<dt>Communication is done via SSH</dt>
			<dd>- Task intructions, Task code and return data all done via ssh.</dd>
			<dt>If you can SSH to a server you can control it with Ansible</dt>
			<dt>No persistent state engine</dt>
			<dd>- State discovered at runtime</dd>
			<dt>No Central Authority</dt>
			<dd>- Can be run from any system that has access rights to the host.</dd>
			<dt>Requirements to run</dt>
			<dd>- <b>Inventory</b> - Potential targets</dd>
			<dd>- <b>State Directives</b> - Single adhoc action or a series of commands in a YAML file</dd>
			<dd>- <b>Credentials</b> - For communication</dd>
		<li class="topic">Get started with Ansible</li>
			<dt>Prereq's for Ansible</dt>
			<dd>- Python 2.6+ with support for Python 3.0 coming</dd>
			<dt>Use of Windows as a control system is <B>NOT</B> supported.</dt>
			<dt><table style="width:98%">
				<tr><td class="codecel" style="width:255px">sudo yum install ansible</td><td></td></tr>
				<tr><td class="codecel" style="width:255px">which ansible</td><td>confirm installation and location</td></tr>
				<tr><td style="width:255px">Output</td><td class="codecel">/usr/bin/ansible</td></tr>
				<tr><td class="codecel" style="width:255px">ansible --version</td><td>check version</td></tr>
				<tr><td style="text-align:left;vertical-align:top">Output</td><td class="codecel">ansible 2.9.9<br>&emsp;config file = /etc/ansible/ansible.cfg<br>&emsp;configured module search path = [u'/home/NONPROD/curtw/.ansible/plugins/modules', u'/usr/share/ansible/plugins/modules']<br>&emsp;ansible python module location = /usr/lib/python2.7/site-packages/ansible<br>&emsp;executable location = /usr/bin/ansible<br>&emsp;python version = 2.7.5 (default, Apr  2 2020, 13:16:51) [GCC 4.8.5 20150623 (Red Hat 4.8.5-39)]</td></tr>
				<tr><td class="codecel" style="width:255px">ansible</td><td>and tabcomplete to see the available ansible commands</td></tr>
				<tr><td style="text-align:left;vertical-align:top">Output</td><td class="codecel">
					<table style="width:100%">
					<tr><td>ansible</td><td>ansible-console</td><td>ansible-doc-2.7</td><td>ansible-playbook</td><td>ansible-pull-2.7</td></tr>
					<tr><td>ansible-2</td><td>ansible-console-2</td><td>ansible-galaxy</td><td>ansible-playbook-2</td><td>ansible-test</td></tr>
					<tr><td>ansible-2.7</td><td>ansible-console-2.7</td><td>ansible-galaxy-2</td><td>ansible-playbook-2.7</td><td>ansible-vault</td></tr>
					<tr><td>ansible-config</td><td>ansible-doc</td><td>ansible-galaxy-2.7</td><td>ansible-pull</td><td>ansible-vault-2</td></tr>
					<tr><td>ansible-connection</td><td>ansible-doc-2</td><td>ansible-inventory</td><td>ansible-pull-2</td><td>ansible-vault-2.7</td></tr>
					</table>
				</td></tr>
				</table>
			</dt>
			<dd>- can also install in a python virtual environment. not going to worry about it now. will look it up if it is ever needed.</dd>
			<dd>- sudo yum install python-virtualenv</dd>
			<dd>- sudo yum install gcc openssl-devel</dd>
	</ul>
	<li class="topic">What Are the Parts of Ansible?</li>
	<ul class="disc">
		<li>Work with hosts and variables
			<dl>
				<dt>Inventory</dt>
				<dd>- A set of potential targets</dd>
				<dd>- Targets required for any Ansible action</dd>
				<dd>- Choice of inventory at execution time</dd>
				<dt>Inventories not tied to specific set of Anisble instructions</dt>
				<dt>Inventory is a list of targets</dt>
				<dd><img src="./images/learn-ansible-ch2-00.jpg" alt="inventory types"></dd>
				<dt>Paterns</dt>
				<dd>- Hosts used in patterns to identify an entity to target or to skip.</dd>
				<dd>- Patterns support wildcards and regular expressions.</dd>
				<dd>- Can be single, inclusive, exclusive and unions</dd>
				<dt>Paterns used to select which servers are targeted</dt>
				<dt>Supports multiple inventories</dt>
				<dd>- Can be single, inclusive, exclusive and unions</dd>
				<dt>Inventory variables</dt>
				<dd>- data related to a host comprised of key end value pairs</dd>
				<dd>- used in task arguements, template configurations, ansible behavior and more</dd>
				<dt>Inventory variables can be in inventory files or in seperate group files.</dt>
				<dd><img src="./images/learn-ansible-ch2-01.jpg" alt="inventory examples" style="width:465px;height:212px;"></dd>
				<dt>Variable Precedence</dt>
				<dd>- can be deplared in multiple places, most specific takes precedence</dd>
				<dd>- All Groups -> Group of Groups -> Group -> Host</dd>
				<dt>Inventory SOurces</dt>
				<dd>- can be static or dynamic</dd>
				<dd>- Static - simple to start with but require manual updates as fleet information cahanges</dd>
				<dd>- Dynamic - provides scripts to fetch sources from Cloud or Containers/VM's. Even a script to fetch from existing ssh_config.</dd>
				<dd>- Many other options available in Ansible source repo. And docs available at <a href="https://docs.ansible.com/ansible/latest/dev_guide/developing_inventory.html">Developing dynamic inventory</a></dd>
			</dl>
		</li>
		<li>Provided code to accomplish work
			<dl>
				<dt>Tasks</dt>
				<dd>- are the actions taken on on a host</dd>
				<dd>- they are as descriptive bit of YAML code with just enough information for Ansible to complete the task.</dd>
				<dt>Tasks Data</dt>
				<dd>- arguments to a script</dd>
				<dt>Tasks Controls</dt>
				<dd>- relate to the task itself</dd>
				<dd>- Looping, Privilege escalation, Conditional execution, etc.</dd>
				<dt>Not just a Task Repeater</dt>
				<dd>- idempotent</dd>
				<dd>- can determine if the tasks intended affect has already been achieved</dd>
				<dt>Determining if a task has been carried out is achieved via the Task return status</dt>
				<dt>Task Return Data</dt>
				<dd><table style="width:250px">
					<tr><td style="font-family:Courier;background-color:orange;width:50%">skipped</td><td style="font-family:Courier;background-color:orange;width:50%">FALSE</td></tr>
					<tr><td class="yamlcel">changed</td><td class="yamlcel">TRUE</td></tr>
					<tr><td class="yamlcel">path</td><td class="yamlcel">/derp</td></tr>
					<tr><td class="yamlcel">mode</td><td class="yamlcel">755</td></tr>
					</table>
				</dd>
				<dt>Modules</dt>
				<dd>- bits of code that Ansible combines with bits of common code</dd>
				<dd><img src="./images/learn-ansible-ch2-02.jpg" alt="inventory examples" style="width:393px;height:103px;"></dd>
				<dt>100's of modules are bundled with Ansible</dt>
				<dd>- <a href="http://docs.ansible.com/ansible/modules_by_category.html">Module Index</a></dd>
				<dt>Extending Ansible</dt>
				<dd>- Easy to create custom modules if there isn't one for what you need to do.</dd>
			</dl>
		</li>
		<li>Playbooks: Collections of tasks
			<dl>
				<dt>Playbooks</dt>
				<dd>- YAML files</dd>
				<dd>&emsp;Collection of one or more plays</dd>
				<dd>- Plays</dd>
				<dd>&emsp;Link tasks with target hosts</dd>
				<dt><font class="code">ansible-playbook</font> is the executable used to run a playbook with the provided inventory.</dt>
				<dd>- Output from "<a href="./images/ansible-playbook-help.txt">ansible-playbook --help</a>"</dd>
				<ol type="1">
					<li>Create list of hosts
						<dt><table style="width:250px">
							<tr><td class="codecel">vim hosts</td></tr>
							<tr><td class="yamlcel">[groupA]<br>host1<br>host2<br>host3<br><br>[groupB]<br>host4<br>host5<br>host6<br><br>[all:vars]<br>ansible_connection=local</td></tr>
						</table></dt>
					</li>
					<li>Create list of tasks
						<dt><table style="width:300px">
							<tr><td class="codecel">vim demoplays.yaml</td></tr>
							<tr><td class="yamlcel">---<br>
							- name: "Do a demo"<br>
							&emsp;hosts: groupA<br><br>
							&emsp;tasks:<br>
							&emsp;&emsp;- name: demo task 1<br>
							&emsp;&emsp;&emsp;debug:<br>
							&emsp;&emsp;&emsp;&emsp;msg: "this is task 1"<br><br>
							&emsp;&emsp;- name: demo task 2<br>
							&emsp;&emsp;&emsp;debug:<br>
							&emsp;&emsp;&emsp;&emsp;msg: "this is task 2"<br><br>
							- name: "Do another demo"<br>
							&emsp;hosts: groupB<br><br>
							&emsp;tasks:<br>
							&emsp;&emsp;- name: demo task 3<br>
							&emsp;&emsp;&emsp;debug:<br>
							&emsp;&emsp;&emsp;&emsp;msg: "this is task 3"<br><br>
							&emsp;&emsp;- name: demo task 4<br>
							&emsp;&emsp;&emsp;debug:<br>
							&emsp;&emsp;&emsp;&emsp;msg: "this is task 4"<br><br>
						</table></dt>
					</li>
					<dt>Execution Order</dt>
					<dd>- Plays and Tasks are executed from top to bottom. i.e. 1 &rarr; 2 &rarr; 3</dd>
					<li>Run the playbook
						<dt><table style="width:400px">
							<tr><td class="codecel">ansible-playbook -i hosts demoplays.yaml</td></tr>
						</table></dt>
						<dd>- <a href="./images/demo-playbook-output.txt">Output from running demo playbook.</a></dd>
					</li>
				</ol>
			</dl>
		</li>
		<li>Control task and play behavior
			<dl>
				<dt>All plays will excute in order unless a fatal errros state occurs</dt>
				<dd>- Potential fatal error states: every host of a play encounters an error or play fails to start because all hosts in a target set have already encountered an error.</dd>
				<dt>Ansible removes a host from the target set if it encounteres an error</dt>
				<dt>Task Conditionals</dt>
				<dd>- Boolean statements</dd>
				<dd>- Evaluated for each target host</dd>
				<dd>- Executes task for host if true/dd>
				<dd>- Skips task for host if false</dd>
				<dd><table style="width:400px">
					<tr><td>modify demoplays.yaml</td></tr>
					<tr><td class="yamlcel">&emsp;&emsp;- name: demo task 2<br>
					&emsp;&emsp;&emsp;<font color="blue"><b>fail:</b></font><br>
					&emsp;&emsp;&emsp;&emsp;msg: "this is task 2"<br>
					&emsp;&emsp;&emsp;<font color="blue"><b>when: inventory_hostname == "host2"</b></font><br>
				</table></dd>
				<dt>Without the "when" this will <a href="./images/demo-playbook-output-fail.txt">fail on all hosts in groupA</a> and will not execute on groupB. With the "when"</dt>
				<dd>it will <a href="./images/demo-playbook-output-conditional-fail.txt">fail on host2 but will execute on all hosts</a>.</dd>
				<dt>Play Controls</dt>
				<dd>- Strategy - Serial, Free</dd>
				<dd>- Max Fail - Percentage, Number</dd>
				<dd>- Privilege - sudo, su</dd>
				<dd><table style="width:350px">
					<tr><td>modify demoplays.yaml</td></tr>
					<tr><td class="yamlcel">&emsp;&emsp;- name: "Do another demo"<br>
							&emsp;hosts: groupB<br>
							&emsp;<font color="blue"><b>serial: 1</a>
				</table></dd>
				<dt>With "serial" <a href="./images/demo-playbook-output-fail.txt">eash task will be run on one host before moving on to the next host</a></dt>
				<dd>instead of performing a task on all hosts before moving on to the next task.</dd>
			</dl>
		</li>
		<li>Challenge: Write a playbook
			<dl>
				<dt>Challenge: Playbook</dt>
				<dd>- <b>Single play</b></dd>
				<dd>- <b>Single task</b> which uses</dd>
				<dd>- <b>pip module</b> to ensure the latest version of the </dd>
				<dd>- <b>Ansible Python package</b> is installed in a python virtual environment</dd>
				<dd>- <b>Virtual environment will be installed in ~/challenge1</b></dd>
				<dt>Goal: Write the playbook</dt>
				<dd>- Do not need an inventory or an active Ansible installation</dd>
			</dl>
		</li>
		<li>Solution: Write a playbook
			<dl>
				<dt>highlight</dt>
				<dd>- note</dd>
				<dt><table style="width:55%">
					<th style="font-family:Courier;background-color:orange;width:50%">My Solution</th><th style="font-family:Courier;background-color:orange">Course's Solution</th>
					<tr>
					<td class="yamlcel" style="width:50%">---<br>
					- name: "Challenge: Playbook"<br>
					&emsp;hosts: groupA<br><br>
					&emsp;tasks:<br>
					&emsp;&emsp;-name: install latest ansible<br>
					&emsp;&emsp;&emsp;pip:<br>
					&emsp;&emsp;&emsp;&emsp;name: ansible<br>
					&emsp;&emsp;&emsp;&emsp;virtualenv: ~/challenge1<br>
					&emsp;&emsp;&emsp;&emsp;virtualenv_site_packages: yes
					</td>
					<td class="yamlcel" style="width:50%">---<br>
					- name: "Challenge Me"<br>
					&emsp;hosts: host1<br><br>
					&emsp;tasks:<br>
					&emsp;&emsp;-name: ansible pip<br>
					&emsp;&emsp;&emsp;pip:<br>
					&emsp;&emsp;&emsp;&emsp;name: ansible<br>
					&emsp;&emsp;&emsp;&emsp;virtualenv: ~/challenge1<br>
					</td>


				</table></dt>
			</dl>
		</li>
	</ul>
	<li class="topic">What Is Ansible Good For</li>
	<ul class="disc">
		<li>Code-driven deployments and operations
			<dl>
				<dt>Configuration Management Automation</dt>
				<dd>- Hand management is too slow or error prone</dd>
				<dd>- Application developers have defined environment expectations</dd>
				<dd>- Ansible provides simple language for expressing configuration directives - readbale by both developers and operators</dd>
				<dt>Infrasstructure Provisioning</dt>
				<dd>- Significant deplays</dd>
				<dd>- Hand-managed resources</dd>
				<dd>- Annual budgets</dd>
				<dt>On-Demand Infrastructure</dt>
				<dd>- DevOps</dd>
				<dd>&emsp;Development and operations - work closly with each other</dd>
				<dd>- Experiments</dd>
				<dd>&emsp;Start quickly</dd>
				<dd>&emsp;Fail quickly</dd>
				<dd>&emsp;Fast feedback</dd>
				<dd>- Infra as Code</dd>
				<dd>&emsp;Lives with application configuration code</dd>
			</dl>
		</li>
		<li>Coordinate complicated sets of actions
			<dl>
				<dt>Orchestration</dt>
				<dd>- Complicated actions with specific order</dd>
				<ul>
					<li>Create list of hosts
						<dt><table style="width:250px">
							<tr><td class="codecel">vim webapp</td></tr>
							<tr><td class="yamlcel">[web]<br>host1<br>host2<br>host3<br><br>[lb]<br>lb1<br>bl2<br><br>[all:vars]<br>ansible_connection=local</td></tr>
						</table></dt>
					</li>
					<li>Create list of tasks
						<dt><table style="width:450px">
							<tr><td class="codecel">vim wed-deploy.yaml</td></tr>
							<tr><td class="yamlcel">---<br>
							- name: Deploy<br>
							&emsp;hosts: web<br>
							&emsp;serial: 1<br><br>
							&emsp;tasks:<br>
							&emsp;&emsp;- name: disable node<br>
							&emsp;&emsp;&emsp;debug:<br>
							&emsp;&emsp;&emsp;&emsp;msg: "disable {{ inventory_hostname }}"<br>
							&emsp;&emsp;&emsp;delegate_to: "{{ groups['lb'][0] }} }}"<br><br>
							&emsp;&emsp;- name: upgrade web<br>
							&emsp;&emsp;&emsp;debug:<br>
							&emsp;&emsp;&emsp;&emsp;msg: "upgrade software"<br><br>
							&emsp;&emsp;- name: enable node<br>
							&emsp;&emsp;&emsp;debug:<br>
							&emsp;&emsp;&emsp;&emsp;msg: "enable {{ inventory_hostname }}"<br>
							&emsp;&emsp;&emsp;delegate_to: "{{ groups['lb'][0] }} }}"<br><br>
						</table></dt>
					</li>
					<li>Run the playbook
						<dt><table style="width:400px">
							<tr><td class="codecel">ansible-playbook -i hosts wed-deploy.yaml</td></tr>
						</table></dt>
						<dd>- <a href="./images/web-deploy-output.txt">Output from running wed-deploy.yaml.</a></dd>
					</li>
				</ul>
			</dl>
		</li>
		<li>Manage system configurations
			<dl>
				<dt>Configuration Management</dt>
				<dd>- Initial applicatiopn install</dd>
				<dd>- Future changes to application configuration</dd>
				<ul>
					<li>Create list of hosts
						<dt>Re-use inventory webapps from above</dt>
					</li>
					<li>Create list of tasks
						<dt><table style="width:900px">
							<tr><td class="codecel">vim wed-app.yaml</td></tr>
							<tr><td class="yamlcel">---<br>
							- name: confiure web app<br>
							&emsp;hosts: web<br>
							&emsp;vars:<br>
							&emsp;&emsp;repo: myrepo.com/repo.git<br>
							&emsp;&emsp;version: 8<br><br>
							&emsp;tasks:<br>
							&emsp;&emsp;- name: install nginx<br>
							&emsp;&emsp;&emsp;debug:<br>
							&emsp;&emsp;&emsp;&emsp;msg: "dnf install nginx (use one of the package management modules, dnf, yum or apt)"<br><br>
							&emsp;&emsp;- name: ensure web directory<br>
							&emsp;&emsp;&emsp;debug:<br>
							&emsp;&emsp;&emsp;&emsp;msg: "mkdir /webapp (using file module)"<br><br>
							&emsp;&emsp;- name: get content<br>
							&emsp;&emsp;&emsp;debug:<br>
							&emsp;&emsp;&emsp;&emsp;msg: "git clone --branch {{ version }} {{ repo}} /webapp (git module)"<br><br>
							&emsp;&emsp;- name: nginx config<br>
							&emsp;&emsp;&emsp;debug:<br>
							&emsp;&emsp;&emsp;&emsp;msg: "put nginx config in place (template module)"<br><br>
							&emsp;&emsp;- name:ensure nginx is running <br>
							&emsp;&emsp;&emsp;debug:<br>
							&emsp;&emsp;&emsp;&emsp;msg: "service nginx start (service module)"<br><br>
						</table></dt>
					</li>
					<li>Run the playbook
						<dt><table style="width:400px">
							<tr><td class="codecel">ansible-playbook -i hosts wed-app.yaml</td></tr>
						</table></dt>
						<dd>- <a href="./images/web-app-output.txt">Output from running wed-app.yaml.</a></dd>
					</li>
				</ul>
			</dl>
		</li>
		<li>React to configuration changes
			<dl>
				<dt>Change Is Inevitable</dt>
				<dt>Handlers</dt>
				<dd>- React to task changes via <b>notify</b></dd>
				<dd>- Allow a single reaction to multiple changing tasks</dd>
				<dd>- Are just tasks whos names have special meaning and are only run when requested.</dd>
				<ul>
					<li>Create list of tasks
						<dt>Modify web-app.yaml from above.</dt>
						<dd><table style="width:600px">
							<tr><td class="codecel">vim web-app.yaml</td></tr>
							<tr><td class="yamlcel">
							&emsp;&emsp;- name: nginx config<br>
							&emsp;&emsp;&emsp;debug:<br>
							&emsp;&emsp;&emsp;&emsp;msg: "put nginx config in place (template module)"<br>
							<font color=blue><b>&emsp;&emsp;&emsp;notify: restart nginx<br>
							&emsp;&emsp;&emsp;changed_when: True</b></font><br>
							...<br>
							&emsp;&emsp;&emsp;&emsp;msg: "service nginx start (service module)"<br><br>
							<font color=blue><b>handlers:<br>
							&emsp;&emsp;- name: restart nginx<br>
							&emsp;&emsp;&emsp;debug:<br>
							&emsp;&emsp;&emsp;&emsp;msg: "service nginx restart"<br>
							</b></font>
						</table></dd>
						<dd>"changed_when: True" tells Ansible to always run the handler task. Leaving it off Ansible will only run when there is a change.
					</li>
					<li>Run the playbook
						<dt><table style="width:450px">
							<tr><td class="codecel">ansible-playbook -i hosts web-app.yaml -vv</td></tr>
						</table></dt>
						<dd>- <a href="./images/web-app-output-2.txt">Output from running web-app.yaml.</a></dd>
					</li>
				</ul>
			</dl>
		</li>
		<li>Infrastructure management
			<dl>
				<dt>Ansible can be used to build servers as well as configure.</dt>
				<dt>Types of Loops in Ansible</dt>
				<dd>- Variable sets</dd>
				<dd>- Sequesnces</dd>
				<dd>- Retries on failure</dd>
				<ul>
					<li>Create list of hosts
						<dt>Re-use inventory webapps from above.</dt>
					</li>
					<li>Create list of tasks
						<dt><table style="width:450px">
							<tr><td class="codecel">vim docker.yaml</td></tr>
							<tr><td class="yamlcel">---<br>
							- name: make dockers<br>
							&emsp;hosts: localhost<br><br>
							&emsp;tasks:<br>
							&emsp;&emsp;- name: make dockers<br>
							&emsp;&emsp;&emsp;docker_container:<br>
							&emsp;&emsp;&emsp;&emsp;image: busybox<br>
							&emsp;&emsp;&emsp;&emsp;command: sleep 1d<br>
							&emsp;&emsp;&emsp;&emsp;name: "busy{{ item }}"<br>
							&emsp;&emsp;&emsp;with_sequence: count=3<br><br>
							&emsp;&emsp;- name: add hosts<br>
							&emsp;&emsp;&emsp;add_host:<br>
							&emsp;&emsp;&emsp;&emsp;name: "busy{{ item }}"<br>
							&emsp;&emsp;&emsp;&emsp;groups: dockers<br>
							&emsp;&emsp;&emsp;&emsp;ansible_connection: docker<br>
							&emsp;&emsp;&emsp;with_sequence: count=3<br><br>
							- name: hi from docker<br>
							&emsp;hosts: dockers<br>
							&emsp;gather_facts: False<br><br>
							&emsp;tasks:<br>
							&emsp;&emsp;- name: ping<br>
							&emsp;&emsp;&emsp;raw: echo $HOSTNAME<br>
						</table></dt>
					</li>
					<li>Run the playbook
						<dt><table style="width:400px">
							<tr><td class="codecel">ansible-playbook -i hosts docker.yaml -v</td></tr>
						</table></dt>
						<dt><a href="./images/docker-error.txt">Playbook didn't work on my server.</a></dd>
						<!--
						<dd>- <a href="./images/docker-output-0.txt">First run of docker.yaml.</a></dd>
						<dd>- <a href="./images/docker-output-1.txt">Second run of docker.yaml.</a></dd>
						<dd>&emsp;Second run is to see that the servers aren't built on subsequent runs.</dd>
						-->
					</li>
				</ul>
			</dl>
		</li>
		<li>Repeat a task across a fleet
			<dl>
				<dt>Not every task requires a saved playbook.</dt>
				<dt>Ad Hoc Tasks</dt>
				<dd>- run single tasks from the command line to a fleet.</dd>
				<dt>Forks</dt>
				<dd>- Maximum number of concurrent hosts</dd>
				<dd>- Limited by size of play or task targets</dd>
				<dd>- Further limited by serial batch size</dd>
				<dd>- -f &lt;numver&gt;</dd>
				<dt><table style="width:750x">
					<tr><td class="codecel">ansible --help | less</td><td class="outputcel"></td></tr>
					<tr><td class="codecel">ansible -i webapp web -m debug -a "msg='shutdown -r now'"</td>
					<td class="outputcel" style="color:green">host1 | SUCCESS => {<br>&emsp;&emsp;"msg": "shutdown -r now"<br>}<br>host2 | SUCCESS => {<br>&emsp;&emsp;"msg": "shutdown -r now"<br>}<br>host3 | SUCCESS => {<br>&emsp;&emsp;"msg": "shutdown -r now"<br>}<br></td>
					</tr>
					<tr><td class="codecel">ansible -i webapp web -m command -a "rpm -q ansible"</td>
					<td class="outputcel" style="color:green">host3 | CHANGED | rc=0 >><br>ansible-2.9.9-1.el7.noarch<br><br>host1 | CHANGED | rc=0 >><br>ansible-2.9.9-1.el7.noarch<br><br>host2 | CHANGED | rc=0 >><br>ansible-2.9.9-1.el7.noarch</td>
					</tr>
					<tr><td class="codecel">ansible-doc copy</td><td class="outputcel"></td>doc on copy module</tr>
					<tr><td class="codecel">ansible -i webapp web -m copy -a "src=filename dest=/tmp/filename"</td><td>got an expected error due to missing module</td></tr>
					<tr><td class="codecel">ansible -i webapp web -m dnf -a "name=libselinux-python state=present" -f 1 -l</td><td>this should have fixed the error above</td></tr>
					</table>
				</dt>
				<dd>- Last few command from this chapter went sideways.</dd>
			</dl>
		</li>
		<li>Challange: Ad-hoc task
			<dl>
				<dt>Challenge: Kernel Release</dt>
				<dd>- Ad hoc task</dd>
				<dd>- Use command module</dd>
				<dd>- Kernal release (uname -r)</dd>
				<dd>- Local system</dd>
			</dl>
		</li>
		<li>Solution: Ad-hoc task
			<dl>
				<dt><table style="width:750x">
					<th style="font-family:Courier;background-color:orange;width:50%">My Solution</th><th style="font-family:Courier;background-color:orange">Course's Solution</th>
					<tr><td class="codecel">ansible -i webapp web -m command -a "uname -r"</td><td class="codecel">ansible -i hosts host1 -m command -a "uname -r"</td><tr>
					<tr><td class="outputcel" style="color:yellow">host1 | CHANGED | rc=0 &gt;&gt;<br>3.10.0-1127.el7.x86_64<br>host2 | CHANGED | rc=0 &gt;&gt;<br>3.10.0-1127.el7.x86_64<br>host3 | CHANGED | rc=0 &gt;&gt;<br>3.10.0-1127.el7.x86_64</td><td class="outputcel" style="color:yellow">host1 | CHANGED | rc=0 &gt;&gt;<br>3.10.0-1127.el7.x86_64</td></tr>
					</table>
				</dt>
			</dl>
		</li>
	</ul>
	<li class="topic">Why Choose Ansible</li>
	<ul class="disc">
		<li>Ansible ease of use
			<dl>
				<dt>Ease of Getting Started</dt>
				<dt>All that is needed:</dt>
				<dd>- An inventory of targets</dd>
				<dd>- A state to assert</dd>
				<dd>- Credentials to log in to hosts</dd>
				<dd>- Open source to audit</dd>
				<dt>Inventory</dt>
				<dd>- Simple INI format</dd>
				<dd>- Easy to create</dd>
				<dd>- Easy to read</dd>
				<dd><img src="./images/learn-ansible-ch4-00.jpg" alt="inventory file contents"></dd>
				<dt>Dynamic Inventory Sources</dt>
				<dd>- Generated from existing fleet tracking systems</dd>
				<dd>- Fast path to accessing production systems</dd>
				<dd>- Removes need to manage multiple sets of data</dd>
				<dt><table style="width:525px">
					<th style="font-family:Courier;background-color:white;width:33%">Tasks</th><th style="font-family:Courier;background-color:white;width:33%">YAML</th><th style="font-family:Courier;background-color:white;width:34%">Simple</th>
					<tr><td class="yamlcel">Expressed in simple YAML</td><td class="yamlcel">Easy to read by humans and machines</td><td class="yamlcel">Quickly onboard new contributors</td></tr>
					</table>
				</dt>
				<dt>Modules</dt>
				<dd>- Just enough abstraction</dd>
				<dd>- Well-documented inputs and outputs</dd>
				<dd>- Hundreds of included modules</dd>
				<dd><img src="./images/learn-ansible-ch4-01.jpg" alt="example task"></dd>
			</dl>
		</li>
		<li>Manage extensions in Ansible
			<dl>
				<dt>Extensions</dt>
				<dd>- Provide additional custom functionality</dd>
				<dt>Three categories of Extensions</dt>
				<dd>- Modules</dd>
				<dd>
					<ul class="disc">
						<li>Extends core</li>
						<li>Logging/display callbacks</li>
						<li>Found in expected paths
							<dt>/usr/share/ansible</dt>
						</li>
					</ul>
				</dd>
				<dd>- Plugins</dd>
				<dd>
					<ul class="disc">
						<li>Many provided</li>
						<li>Most common extension</li>
						<li>Communication</li>
						<li>Template filters</li>
					</ul>
				</dd>
				<dd>- Dynamic Inventories</dd>
				<dd>
					<ul class="disc">
						<li>Executable/li>
						<li>Returns JSON data</li>
						<li>Infra as a service</li>
						<li>Existing IT assest management</li>
					</ul>
				</dd>
			</dl>
		</li>
		<li>Advantages to using Ansible
			<dl>
				<dt>Lots of choices </dt>
				<dd>- Ansible advantages</dd>
				<dd>Playbooks Task and Modules
					<ul class="disc">
						<li>Enough Abstraction
						<dt>Desired state in simple text, not code</dt>
						<dt>East-to-review changes</dt>
						</li>
						<li>Top-Down Execution
						<dt>Order - can be expected and followed</dt>
						<dt>Easy-to-express dependencies</dt>
						</li>
					</ul>
				</dd>
				<dd>Portable playbooks
					<ul class="disc">
						<li>Highly portable</li>
						<li>Well suited for source control</li>
						<li>Often can be executed from any system that has access to the host</li>
						<li>Custom extensions can be bundled alsode the playbooks</li>
					</ul>
				</dd>
				<ol>
					<li>Open Source<dt>Free</dt></li>
					<li>Start small<dt>Scale big</dt></li>
					<li>Low Barrier<dt>Quick to learn</dt></li>
				</ol>
				<dd>Reduced Toolbox
					<ul class="disc">
						<li>Ad Hoc<dt>One-off tasks ascross (parts of) the fleet</dt></li>
						<li>Orchestration<dt>Complicated application upgrades</dt></li>
						<li>Configuration Management<dt>Software and service configuration management</dt></li>
					</ul>
				</dd>
				<dd>No agents</dd>
				<dd>No state</dd>
				<dd>No Bootstrap</dd>
			</dl>
		</li>
	</ul>
	<li class="topic">Conclusion</li>
	<ul class="disc">
		<li>Ansible
			<dt>
		<li>Next steps
			<dl>
				<dt>Want to Write Extensions</dt>
				<dd>- Recommended Course: Up and Running with Python</dd>
				<dt>Cloud Computing</dt>
				<dd>- Recommended Course: The Cloud and DevOps</dd>
			</dl>
		<li>Completed: 6/6/2020</li>
		<li>Next Course: <a href="./essential-ansible-training.html">Ansible Essential Training</a></li>
	</ul>
</ol>
<!--
	<font style="color:red"><b>Topics not updated below here.</b></font><br>
	<li class="topic">new topic</li>
	<ul class="disc">
		<li>topic
			<dl>  
				<dt>highlight</dt>
				<dd>- note</dd>
				<dt><table style="width:525px">
					<tr><td class="codecel">git command</td><td>description</td></tr>
					</table>
				</dt>
			</dl>
		</li>
	</ul>

	<li class="topic">new topic</li>
	<ul class="disc">
		<li>topic
			<dl>
				<dt>highlight</dt>
				<dd>- note</dd>
				<dt><table style="width:525px">
					<tr><tr><td class="codecel">git command</td><td>description</td></tr>
					</table>
				</dt>
			</dl>
		</li>
	</ul>
-->

</ol>
<h2 ></h2>
<p style="color:red"></p>
<p title="I'm a tooltip"></p>
<a href="./index.html">Back</a>
</body>
</html>